<p-accordion-panel value="2">
  <p-accordion-header>Lieferanten Verwaltung</p-accordion-header>
  <p-accordion-content>
    <div class="flex flex-column gap-4 p-4">
      <div class="flex justify-content-between align-items-center">
        <p>Konfiguration der Lieferanten</p>
        <p-button
          type="button"
          label="Lieferant hinzufügen"
          (onClick)="showAddSupplierDialog()"
          styleClass="w-auto"
          icon="pi pi-plus"
        ></p-button>
      </div>

      <p-dataView #dv [value]="suppliers()">
        <ng-template let-items #list>
          <div class="grid grid-nogutter">
            @for (item of suppliers(); track item; let first = $first) {
              <div class="col-12">
                <div
                  class="flex flex-column xl:flex-row xl:align-items-start p-4 gap-4"
                  [ngClass]="{ 'border-top-1 surface-border': !first }"
                >
                  <img
                    height="75"
                    [style.width]="'auto'"
                    [src]="'/assets/logos/' + item.logo"
                    [alt]="item.name"
                  />
                  <div
                    class="flex flex-column sm:flex-row justify-content-between align-items-center xl:align-items-start flex-1 gap-4"
                  >
                    <div class="flex flex-column align-items-center sm:align-items-start gap-3">
                      <div class="text-2xl font-bold text-900">
                        {{ item.name }}
                      </div>
                      <div class="text-900">AAS Repository: {{ item.remoteAasRepositoryUrl }}</div>
                      @if (item.remoteSmRepositoryUrl) {
                        <div class="text-900">SM Repository: {{ item.remoteSmRepositoryUrl }}</div>
                      }
                    </div>
                  </div>
                  <div class="flex gap-2">
                    <p-button
                      icon="pi pi-pencil"
                      rounded="true"
                      (onClick)="editSupplier(item)"
                      severity="secondary"
                    ></p-button>
                    <p-button
                      icon="pi pi-trash"
                      rounded="true"
                      (onClick)="deleteSupplier(item)"
                      severity="danger"
                    ></p-button>
                  </div>
                </div>
              </div>
            }
          </div>
        </ng-template>
      </p-dataView>
    </div>
  </p-accordion-content>
</p-accordion-panel>

<!-- Dialog für neuen Lieferanten -->
<p-dialog
  [visible]="addSupplierDialogVisible()"
  (visibleChange)="addSupplierDialogVisible.set($event)"
  header="Neuen Lieferanten hinzufügen"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
>
  @if (newSupplier()) {
    <div class="flex flex-column gap-3 p-4">
      <div class="flex flex-column gap-2">
        <label for="name" class="block text-900 font-medium">Name</label>
        <input
          id="name"
          type="text"
          placeholder="Name des Lieferanten"
          pInputText
          class="w-full"
          [ngModel]="newSupplier()?.name"
          (ngModelChange)="updateSupplierName($event)"
        />
      </div>

      <div class="flex flex-column gap-2">
        <label for="logo" class="block text-900 font-medium">Logo</label>
        <input
          id="logo"
          type="text"
          placeholder="Logo-Dateiname (z.B. logo.png)"
          pInputText
          class="w-full"
          [ngModel]="newSupplier()?.logo"
          (ngModelChange)="updateSupplierLogo($event)"
        />
      </div>

      <app-aas-endpoints-configuration
        [aasRepositoryUrl]="newSupplier()?.remoteAasRepositoryUrl || ''"
        [submodelRepositoryUrl]="newSupplier()?.remoteSmRepositoryUrl || ''"
        [aasRegistryUrl]="newSupplier()?.remoteAasRegistryUrl || ''"
        [submodelRegistryUrl]="newSupplier()?.remoteSmRegistryUrl || ''"
        [discoveryUrl]="newSupplier()?.remoteDiscoveryUrl || ''"
        [conceptDescriptionUrl]="newSupplier()?.remoteCdRepositoryUrl || ''"
        [headerParameters]="newSupplier()?.securitySetting?.headerParameters || []"
        [certificate]="newSupplier()?.securitySetting?.certificate || ''"
        [certificatePassword]="newSupplier()?.securitySetting?.certificatePassword || ''"
        [securityLegend]="'Supplier-Authentifizierung'"
        [showCertificate]="true"
        (aasRepositoryUrlChange)="updateSupplierAasRepositoryUrl($event)"
        (submodelRepositoryUrlChange)="updateSupplierSmRepositoryUrl($event)"
        (aasRegistryUrlChange)="updateSupplierAasRegistryUrl($event)"
        (submodelRegistryUrlChange)="updateSupplierSmRegistryUrl($event)"
        (discoveryUrlChange)="updateSupplierDiscoveryUrl($event)"
        (conceptDescriptionUrlChange)="updateSupplierCdRepositoryUrl($event)"
        (headerParametersChange)="onSupplierSecurityHeadersChange($event)"
        (certificateChange)="onSupplierCertificateChange($event)"
        (certificatePasswordChange)="onSupplierCertificatePasswordChange($event)"
      >
      </app-aas-endpoints-configuration>

      <div class="flex justify-content-end gap-2 mt-3">
        <p-button
          type="button"
          label="Abbrechen"
          (onClick)="addSupplierDialogVisible.set(false)"
          severity="secondary"
          variant="text"
        ></p-button>
        <p-button
          type="button"
          label="Speichern"
          (onClick)="saveSupplier()"
          icon="pi pi-save"
        ></p-button>
      </div>
    </div>
  }
</p-dialog>

<!-- Dialog für Lieferanten bearbeiten -->
<p-dialog
  [visible]="editSupplierDialogVisible()"
  (visibleChange)="editSupplierDialogVisible.set($event)"
  header="Lieferanten bearbeiten"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
>
  @if (supplierToEdit()) {
    <div class="flex flex-column gap-3 p-4">
      <div class="flex flex-column gap-2">
        <label for="editName" class="block text-900 font-medium">Name</label>
        <input
          id="editName"
          type="text"
          placeholder="Name des Lieferanten"
          pInputText
          class="w-full"
          [ngModel]="supplierToEdit()?.name"
          (ngModelChange)="updateEditSupplierName($event)"
        />
      </div>

      <div class="flex flex-column gap-2">
        <label for="editLogo" class="block text-900 font-medium">Logo</label>
        <input
          id="editLogo"
          type="text"
          placeholder="Logo-Dateiname (z.B. logo.png)"
          pInputText
          class="w-full"
          [ngModel]="supplierToEdit()?.logo"
          (ngModelChange)="updateEditSupplierLogo($event)"
        />
      </div>

      <app-aas-endpoints-configuration
        [aasRepositoryUrl]="supplierToEdit()?.remoteAasRepositoryUrl || ''"
        [submodelRepositoryUrl]="supplierToEdit()?.remoteSmRepositoryUrl || ''"
        [aasRegistryUrl]="supplierToEdit()?.remoteAasRegistryUrl || ''"
        [submodelRegistryUrl]="supplierToEdit()?.remoteSmRegistryUrl || ''"
        [discoveryUrl]="supplierToEdit()?.remoteDiscoveryUrl || ''"
        [conceptDescriptionUrl]="supplierToEdit()?.remoteCdRepositoryUrl || ''"
        [headerParameters]="supplierToEdit()?.securitySetting?.headerParameters || []"
        [certificate]="supplierToEdit()?.securitySetting?.certificate || ''"
        [certificatePassword]="supplierToEdit()?.securitySetting?.certificatePassword || ''"
        [securityLegend]="'Supplier-Authentifizierung'"
        [showCertificate]="true"
        (aasRepositoryUrlChange)="updateEditSupplierAasRepositoryUrl($event)"
        (submodelRepositoryUrlChange)="updateEditSupplierSmRepositoryUrl($event)"
        (aasRegistryUrlChange)="updateEditSupplierAasRegistryUrl($event)"
        (submodelRegistryUrlChange)="updateEditSupplierSmRegistryUrl($event)"
        (discoveryUrlChange)="updateEditSupplierDiscoveryUrl($event)"
        (conceptDescriptionUrlChange)="updateEditSupplierCdRepositoryUrl($event)"
        (headerParametersChange)="onEditSupplierSecurityHeadersChange($event)"
        (certificateChange)="onEditSupplierCertificateChange($event)"
        (certificatePasswordChange)="onEditSupplierCertificatePasswordChange($event)"
      >
      </app-aas-endpoints-configuration>

      <div class="flex justify-content-end gap-2 mt-3">
        <p-button
          type="button"
          label="Abbrechen"
          (onClick)="editSupplierDialogVisible.set(false)"
          severity="secondary"
          variant="text"
        ></p-button>
        <p-button
          type="button"
          label="Änderungen speichern"
          (onClick)="saveEditSupplier()"
          icon="pi pi-save"
        ></p-button>
      </div>
    </div>
  }
</p-dialog>
