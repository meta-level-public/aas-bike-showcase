<p-accordion-panel value="2">
  <p-accordion-header>Lieferanten Verwaltung</p-accordion-header>
  <p-accordion-content>
    <div class="flex flex-column gap-4 p-4">
      <div class="flex justify-content-between align-items-center">
        <p>Konfiguration der Lieferanten</p>
        <p-button
          type="button"
          label="Lieferant hinzufügen"
          (onClick)="showAddSupplierDialog()"
          styleClass="w-auto"
          icon="pi pi-plus"
        ></p-button>
      </div>

      <p-dataView #dv [value]="suppliers()">
        <ng-template let-items #list>
          <div class="grid grid-nogutter">
            @for (item of suppliers(); track item; let first = $first) {
            <div class="col-12">
              <div
                class="flex flex-column xl:flex-row xl:align-items-start p-4 gap-4"
                [ngClass]="{ 'border-top-1 surface-border': !first }"
              >
                <img
                  height="75"
                  [style.width]="'auto'"
                  [src]="'/assets/logos/' + item.logo"
                  [alt]="item.name"
                />
                <div
                  class="flex flex-column sm:flex-row justify-content-between align-items-center xl:align-items-start flex-1 gap-4"
                >
                  <div
                    class="flex flex-column align-items-center sm:align-items-start gap-3"
                  >
                    <div class="text-2xl font-bold text-900">
                      {{ item.name }}
                    </div>
                    <div class="text-900">
                      AAS Repository: {{ item.remoteAasRepositoryUrl }}
                    </div>
                    @if (item.remoteSmRepositoryUrl) {
                    <div class="text-900">
                      SM Repository: {{ item.remoteSmRepositoryUrl }}
                    </div>
                    }
                  </div>
                </div>
                <div class="flex gap-2">
                  <p-button
                    icon="pi pi-pencil"
                    rounded="true"
                    (onClick)="editSupplier(item)"
                    severity="secondary"
                  ></p-button>
                  <p-button
                    icon="pi pi-trash"
                    rounded="true"
                    (onClick)="deleteSupplier(item)"
                    severity="danger"
                  ></p-button>
                </div>
              </div>
            </div>
            }
          </div>
        </ng-template>
      </p-dataView>
    </div>
  </p-accordion-content>
</p-accordion-panel>

<!-- Dialog für neuen Lieferanten -->
<p-dialog
  [visible]="addSupplierDialogVisible()"
  (visibleChange)="addSupplierDialogVisible.set($event)"
  header="Neuen Lieferanten hinzufügen"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
>
  @if (newSupplier()) {
  <div class="flex flex-column gap-3 p-4">
    <div class="flex flex-column gap-2">
      <label for="name" class="block text-900 font-medium">Name</label>
      <input
        id="name"
        type="text"
        placeholder="Name des Lieferanten"
        pInputText
        class="w-full"
        [ngModel]="newSupplier()?.name"
        (ngModelChange)="updateSupplierName($event)"
      />
    </div>

    <div class="flex flex-column gap-2">
      <label for="logo" class="block text-900 font-medium">Logo</label>
      <input
        id="logo"
        type="text"
        placeholder="Logo-Dateiname (z.B. logo.png)"
        pInputText
        class="w-full"
        [ngModel]="newSupplier()?.logo"
        (ngModelChange)="updateSupplierLogo($event)"
      />
    </div>

    <div class="flex flex-column gap-2">
      <label for="aasRepositoryUrl" class="block text-900 font-medium"
        >AAS Repository URL</label
      >
      <input
        id="aasRepositoryUrl"
        type="text"
        placeholder="https://example.com/aas-repository"
        pInputText
        class="w-full"
        [ngModel]="newSupplier()?.remoteAasRepositoryUrl"
        (ngModelChange)="updateSupplierAasRepositoryUrl($event)"
      />
    </div>

    <div class="flex flex-column gap-2">
      <label for="smRepositoryUrl" class="block text-900 font-medium"
        >SM Repository URL</label
      >
      <input
        id="smRepositoryUrl"
        type="text"
        placeholder="https://example.com/sm-repository"
        pInputText
        class="w-full"
        [ngModel]="newSupplier()?.remoteSmRepositoryUrl"
        (ngModelChange)="updateSupplierSmRepositoryUrl($event)"
      />
    </div>

    <div class="flex flex-column gap-2">
      <label for="aasRegistryUrl" class="block text-900 font-medium"
        >AAS Registry URL</label
      >
      <input
        id="aasRegistryUrl"
        type="text"
        placeholder="https://example.com/aas-registry"
        pInputText
        class="w-full"
        [ngModel]="newSupplier()?.remoteAasRegistryUrl"
        (ngModelChange)="updateSupplierAasRegistryUrl($event)"
      />
    </div>

    <div class="flex flex-column gap-2">
      <label for="smRegistryUrl" class="block text-900 font-medium"
        >SM Registry URL</label
      >
      <input
        id="smRegistryUrl"
        type="text"
        placeholder="https://example.com/sm-registry"
        pInputText
        class="w-full"
        [ngModel]="newSupplier()?.remoteSmRegistryUrl"
        (ngModelChange)="updateSupplierSmRegistryUrl($event)"
      />
    </div>

    <div class="flex flex-column gap-2">
      <label for="discoveryUrl" class="block text-900 font-medium"
        >Discovery URL</label
      >
      <input
        id="discoveryUrl"
        type="text"
        placeholder="https://example.com/discovery"
        pInputText
        class="w-full"
        [ngModel]="newSupplier()?.remoteDiscoveryUrl"
        (ngModelChange)="updateSupplierDiscoveryUrl($event)"
      />
    </div>

    <div class="flex flex-column gap-2">
      <label for="cdRepositoryUrl" class="block text-900 font-medium"
        >CD Repository URL</label
      >
      <input
        id="cdRepositoryUrl"
        type="text"
        placeholder="https://example.com/cd-repository"
        pInputText
        class="w-full"
        [ngModel]="newSupplier()?.remoteCdRepositoryUrl"
        (ngModelChange)="updateSupplierCdRepositoryUrl($event)"
      />
    </div>

    <!-- Supplier Security Configuration -->
    <app-security-configuration
      [headerParameters]="newSupplier()?.securitySetting?.headerParameters || []"
      [certificate]="newSupplier()?.securitySetting?.certificate || ''"
      [certificatePassword]="newSupplier()?.securitySetting?.certificatePassword || ''"
      [legend]="'Supplier-Authentifizierung'"
      [showCertificate]="true"
      (headerParametersChange)="onSupplierSecurityHeadersChange($event)"
      (certificateChange)="onSupplierCertificateChange($event)"
      (certificatePasswordChange)="onSupplierCertificatePasswordChange($event)">
    </app-security-configuration>

    <div class="flex justify-content-end gap-2 mt-3">
      <p-button
        type="button"
        label="Abbrechen"
        (onClick)="addSupplierDialogVisible.set(false)"
        severity="secondary"
        variant="text"
      ></p-button>
      <p-button
        type="button"
        label="Speichern"
        (onClick)="saveSupplier()"
        icon="pi pi-save"
      ></p-button>
    </div>
  </div>
  }
</p-dialog>

<!-- Dialog für Lieferanten bearbeiten -->
<p-dialog
  [visible]="editSupplierDialogVisible()"
  (visibleChange)="editSupplierDialogVisible.set($event)"
  header="Lieferanten bearbeiten"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
>
  @if (supplierToEdit()) {
  <div class="flex flex-column gap-3 p-4">
    <div class="flex flex-column gap-2">
      <label for="editName" class="block text-900 font-medium">Name</label>
      <input
        id="editName"
        type="text"
        placeholder="Name des Lieferanten"
        pInputText
        class="w-full"
        [ngModel]="supplierToEdit()?.name"
        (ngModelChange)="updateEditSupplierName($event)"
      />
    </div>

    <div class="flex flex-column gap-2">
      <label for="editLogo" class="block text-900 font-medium">Logo</label>
      <input
        id="editLogo"
        type="text"
        placeholder="Logo-Dateiname (z.B. logo.png)"
        pInputText
        class="w-full"
        [ngModel]="supplierToEdit()?.logo"
        (ngModelChange)="updateEditSupplierLogo($event)"
      />
    </div>

    <div class="flex flex-column gap-2">
      <label for="editAasRepositoryUrl" class="block text-900 font-medium"
        >AAS Repository URL</label
      >
      <input
        id="editAasRepositoryUrl"
        type="text"
        placeholder="https://example.com/aas-repository"
        pInputText
        class="w-full"
        [ngModel]="supplierToEdit()?.remoteAasRepositoryUrl"
        (ngModelChange)="updateEditSupplierAasRepositoryUrl($event)"
      />
    </div>

    <div class="flex flex-column gap-2">
      <label for="editSmRepositoryUrl" class="block text-900 font-medium"
        >SM Repository URL</label
      >
      <input
        id="editSmRepositoryUrl"
        type="text"
        placeholder="https://example.com/sm-repository"
        pInputText
        class="w-full"
        [ngModel]="supplierToEdit()?.remoteSmRepositoryUrl"
        (ngModelChange)="updateEditSupplierSmRepositoryUrl($event)"
      />
    </div>

    <div class="flex flex-column gap-2">
      <label for="editAasRegistryUrl" class="block text-900 font-medium"
        >AAS Registry URL</label
      >
      <input
        id="editAasRegistryUrl"
        type="text"
        placeholder="https://example.com/aas-registry"
        pInputText
        class="w-full"
        [ngModel]="supplierToEdit()?.remoteAasRegistryUrl"
        (ngModelChange)="updateEditSupplierAasRegistryUrl($event)"
      />
    </div>

    <div class="flex flex-column gap-2">
      <label for="editSmRegistryUrl" class="block text-900 font-medium"
        >SM Registry URL</label
      >
      <input
        id="editSmRegistryUrl"
        type="text"
        placeholder="https://example.com/sm-registry"
        pInputText
        class="w-full"
        [ngModel]="supplierToEdit()?.remoteSmRegistryUrl"
        (ngModelChange)="updateEditSupplierSmRegistryUrl($event)"
      />
    </div>

    <div class="flex flex-column gap-2">
      <label for="editDiscoveryUrl" class="block text-900 font-medium"
        >Discovery URL</label
      >
      <input
        id="editDiscoveryUrl"
        type="text"
        placeholder="https://example.com/discovery"
        pInputText
        class="w-full"
        [ngModel]="supplierToEdit()?.remoteDiscoveryUrl"
        (ngModelChange)="updateEditSupplierDiscoveryUrl($event)"
      />
    </div>

    <div class="flex flex-column gap-2">
      <label for="editCdRepositoryUrl" class="block text-900 font-medium"
        >CD Repository URL</label
      >
      <input
        id="editCdRepositoryUrl"
        type="text"
        placeholder="https://example.com/cd-repository"
        pInputText
        class="w-full"
        [ngModel]="supplierToEdit()?.remoteCdRepositoryUrl"
        (ngModelChange)="updateEditSupplierCdRepositoryUrl($event)"
      />
    </div>

    <!-- Supplier Security Configuration -->
    <app-security-configuration
      [headerParameters]="supplierToEdit()?.securitySetting?.headerParameters || []"
      [certificate]="supplierToEdit()?.securitySetting?.certificate || ''"
      [certificatePassword]="supplierToEdit()?.securitySetting?.certificatePassword || ''"
      [legend]="'Supplier-Authentifizierung'"
      [showCertificate]="true"
      (headerParametersChange)="onEditSupplierSecurityHeadersChange($event)"
      (certificateChange)="onEditSupplierCertificateChange($event)"
      (certificatePasswordChange)="onEditSupplierCertificatePasswordChange($event)">
    </app-security-configuration>

    <div class="flex justify-content-end gap-2 mt-3">
      <p-button
        type="button"
        label="Abbrechen"
        (onClick)="editSupplierDialogVisible.set(false)"
        severity="secondary"
        variant="text"
      ></p-button>
      <p-button
        type="button"
        label="Änderungen speichern"
        (onClick)="saveEditSupplier()"
        icon="pi pi-save"
      ></p-button>
    </div>
  </div>
  }
</p-dialog>
