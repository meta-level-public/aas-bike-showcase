<div class="surface-ground px-4 py-5 md:px-6 lg:px-8">
  <div class="card mt-2">
    <p-accordion [value]="['0', '1', '2']" [multiple]="true">

      <!-- ERP System Bereich -->
      <p-accordion-panel value="0">
        <p-accordion-header>ERP System Konfiguration</p-accordion-header>
        <p-accordion-content>
        <div class="flex flex-column gap-4 p-4">
          <div class="flex flex-column gap-2">
            <label>ERP System wählen</label>
            <p-selectButton
              [options]="erpOptions"
              [(ngModel)]="selectedErp"
              optionLabel="label"
              >
              <ng-template let-item pTemplate>
                <div
                  class="flex flex-column h-3rem justify-content-end gap-2 mt-2 align-items-center"
                  >
                  <img
                    src="assets/logos/{{ item.logo }}"
                    width="32"
                    style="vertical-align: middle"
                    />
                  <span>{{ item.label }}</span>
                </div>
              </ng-template>
            </p-selectButton>
          </div>

          <div class="flex flex-column gap-2">
            @if (selectedErp) {
              @if (selectedErp.label == 'Meta SimplestErp') {
                <div class="flex flex-column gap-2">
                  Beim Eigenen ERP-System ist keine Konfiguration notwendig.
                </div>
              }
              @if (selectedErp.label != 'Meta SimplestErp') {
                <div class="flex flex-column gap-2">
                  <label>Mapping</label>
                  <p>
                    Hier wird jetzt ein Mapping für Felder des ERP-Systems zu Feldern
                    aus der AAS/Speziellen Teilmodellen vorgenommen.
                  </p>
                  <p>Beispiele:</p>
                  <ul>
                    <li>
                      Produktfamilie aus dem Digital Nameplate ==> Kategorie des Teils
                    </li>
                    <li>Hersteller aus Digital Nameplate ==> Hersteller des Teils</li>
                    <li>
                      Produktbeschreibung aus dem Digital Nameplate ==> Beschreibung
                    </li>
                    <li>
                      Produktbezeichnung aus dem Digital Nameplate ==> Bezeichnung
                    </li>
                    <li>Globale Asset ID ==> Eindeutige Kennung</li>
                    <li>...</li>
                  </ul>
                </div>
              }
              <button
                pButton
                type="button"
                label="ERP Konfiguration Speichern"
                (click)="saveSettings()"
                class="w-auto mt-2"
                icon="pi pi-save"
              ></button>
            }
          </div>
        </div>
        </p-accordion-content>
      </p-accordion-panel>

      <!-- AAS Infrastructure Bereich -->
      <p-accordion-panel value="1">
        <p-accordion-header>AAS Infrastructure URLs</p-accordion-header>
        <p-accordion-content>
        <div class="flex flex-column gap-4 p-4">
          <p>Konfiguration der Asset Administration Shell (AAS) Infrastruktur URLs</p>

          <div class="grid">
            <div class="col-12 md:col-6">
              <label for="aasRepositoryUrl" class="block text-900 font-medium mb-2">AAS Repository URL</label>
              <input
                id="aasRepositoryUrl"
                type="text"
                placeholder="http://localhost:8080/shells"
                pInputText
                class="w-full mb-3"
                [(ngModel)]="aasRepositoryUrl"
              />
            </div>

            <div class="col-12 md:col-6">
              <label for="aasRegistryUrl" class="block text-900 font-medium mb-2">AAS Registry URL</label>
              <input
                id="aasRegistryUrl"
                type="text"
                placeholder="http://localhost:8081/registry"
                pInputText
                class="w-full mb-3"
                [(ngModel)]="aasRegistryUrl"
              />
            </div>

            <div class="col-12 md:col-6">
              <label for="submodelRepositoryUrl" class="block text-900 font-medium mb-2">Submodel Repository URL</label>
              <input
                id="submodelRepositoryUrl"
                type="text"
                placeholder="http://localhost:8082/submodels"
                pInputText
                class="w-full mb-3"
                [(ngModel)]="submodelRepositoryUrl"
              />
            </div>

            <div class="col-12 md:col-6">
              <label for="submodelRegistryUrl" class="block text-900 font-medium mb-2">Submodel Registry URL</label>
              <input
                id="submodelRegistryUrl"
                type="text"
                placeholder="http://localhost:8083/registry"
                pInputText
                class="w-full mb-3"
                [(ngModel)]="submodelRegistryUrl"
              />
            </div>

            <div class="col-12 md:col-6">
              <label for="discoveryUrl" class="block text-900 font-medium mb-2">Discovery URL</label>
              <input
                id="discoveryUrl"
                type="text"
                placeholder="http://localhost:8084/discovery"
                pInputText
                class="w-full mb-3"
                [(ngModel)]="discoveryUrl"
              />
            </div>

            <div class="col-12 md:col-6">
              <label for="conceptDescriptionUrl" class="block text-900 font-medium mb-2">Concept Description URL</label>
              <input
                id="conceptDescriptionUrl"
                type="text"
                placeholder="http://localhost:8085/concept-descriptions"
                pInputText
                class="w-full mb-3"
                [(ngModel)]="conceptDescriptionUrl"
              />
            </div>
          </div>

          <button
            pButton
            type="button"
            label="AAS URLs Speichern"
            (click)="saveAasUrls()"
            class="w-auto"
            icon="pi pi-save"
          ></button>
        </div>
        </p-accordion-content>
      </p-accordion-panel>

      <!-- Lieferanten Bereich -->
      <p-accordion-panel value="2">
        <p-accordion-header>Lieferanten Verwaltung</p-accordion-header>
        <p-accordion-content>
        <div class="flex flex-column gap-4 p-4">
          <div class="flex justify-content-between align-items-center">
          <p>Konfiguration der Lieferanten</p>
            <button
              pButton
              type="button"
              label="Lieferant hinzufügen"
              (click)="showAddSupplierDialog()"
              class="w-auto"
              icon="pi pi-plus"
            ></button>
          </div>

          <p-dataView #dv [value]="suppliers">
            <ng-template pTemplate="list" let-products>
              <div class="grid grid-nogutter">
                @for (item of suppliers; track item; let first = $first) {
                  <div class="col-12">
                    <div
                      class="flex flex-column xl:flex-row xl:align-items-start p-4 gap-4"
                      [ngClass]="{ 'border-top-1 surface-border': !first }"
                      >
                      <img
                        height="75"
                        [style.width]="'auto'"
                        [src]="'/assets/logos/' + item.logo"
                        [alt]="item.name"
                        />
                      <div
                        class="flex flex-column sm:flex-row justify-content-between align-items-center xl:align-items-start flex-1 gap-4"
                        >
                        <div
                          class="flex flex-column align-items-center sm:align-items-start gap-3"
                          >
                          <div class="text-2xl font-bold text-900">
                            {{ item.name }}
                          </div>
                          <div class="text-900">
                            {{ item.remoteRepositoryUrl }}
                          </div>
                        </div>
                      </div>
                      <p-button
                        icon="pi pi-trash"
                        class="p-button-rounded p-button-danger"
                        (click)="deleteSupplier(item)"
                      ></p-button>
                    </div>
                  </div>
                }
              </div>
            </ng-template>
          </p-dataView>
        </div>
        </p-accordion-content>
      </p-accordion-panel>

    </p-accordion>
  </div>

  <!-- Dialog für neuen Lieferanten -->
  <p-dialog [(visible)]="addSupplierDialogVisible" header="Neuen Lieferanten hinzufügen" [modal]="true" [draggable]="false" [resizable]="false">
    @if (newSupplier) {
      <div class="flex flex-column gap-3 p-4">
        <div class="flex flex-column gap-2">
          <label for="name" class="block text-900 font-medium">Name</label>
          <input
            id="name"
            type="text"
            placeholder="Name des Lieferanten"
            pInputText
            class="w-full"
            [(ngModel)]="newSupplier.name"
          />
        </div>

        <div class="flex flex-column gap-2">
          <label for="logo" class="block text-900 font-medium">Logo</label>
          <input
            id="logo"
            type="text"
            placeholder="Logo-Dateiname (z.B. logo.png)"
            pInputText
            class="w-full"
            [(ngModel)]="newSupplier.logo"
          />
        </div>

        <div class="flex flex-column gap-2">
          <label for="repositoryUrl" class="block text-900 font-medium">Repository URL</label>
          <input
            id="repositoryUrl"
            type="text"
            placeholder="https://example.com/repository"
            pInputText
            class="w-full"
            [(ngModel)]="newSupplier.remoteRepositoryUrl"
          />
        </div>

        <div class="flex justify-content-end gap-2 mt-3">
          <button
            pButton
            type="button"
            label="Abbrechen"
            (click)="addSupplierDialogVisible = false"
            class="p-button-text"
          ></button>
          <button
            pButton
            type="button"
            label="Speichern"
            (click)="saveSupplier()"
            icon="pi pi-save"
          ></button>
        </div>
      </div>
    }
  </p-dialog>
</div>
