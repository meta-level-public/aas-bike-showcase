<p-accordion-panel value="3">
  <p-accordion-header>{{ 'setup.companyAddress' | translate }}</p-accordion-header>
  <p-accordion-content>
    <div class="grid">
      <div class="col-12">
        <h5>{{ 'setup.configureCompanyAddress' | translate }}</h5>
        <p class="text-color-secondary">
          {{ 'setup.companyAddressDescription' | translate }}
        </p>
      </div>
    </div>

    <div class="grid">
      <!-- Name und Vorname -->
      <div class="field col-12 md:col-12">
        <label for="companyName">{{ 'setup.companyName' | translate }}</label>
        <input
          id="companyName"
          type="text"
          pInputText
          class="w-full"
          [value]="address().name || ''"
          (input)="updateAddress('name', $any($event.target).value)"
          [placeholder]="'setup.companyNamePlaceholder' | translate"
        />
      </div>

      <!-- StraÃŸe -->
      <div class="field col-12">
        <label for="street">{{ 'order.create.street' | translate }}</label>
        <input
          id="street"
          type="text"
          pInputText
          class="w-full"
          [value]="address().strasse || ''"
          (input)="updateAddress('strasse', $any($event.target).value)"
          [placeholder]="'setup.streetPlaceholder' | translate"
        />
      </div>

      <!-- PLZ und Ort -->
      <div class="field col-12 md:col-4">
        <label for="zipCode">{{ 'order.create.postalCode' | translate }}</label>
        <input
          id="zipCode"
          type="text"
          pInputText
          class="w-full"
          [value]="address().plz || ''"
          (input)="updateAddress('plz', $any($event.target).value)"
          [placeholder]="'setup.postalCodePlaceholder' | translate"
        />
      </div>

      <div class="field col-12 md:col-8">
        <label for="city">{{ 'order.create.city' | translate }}</label>
        <input
          id="city"
          type="text"
          pInputText
          class="w-full"
          [value]="address().ort || ''"
          (input)="updateAddress('ort', $any($event.target).value)"
          [placeholder]="'setup.cityPlaceholder' | translate"
        />
      </div>

      <!-- Land -->
      <div class="field col-12">
        <label for="country">{{ 'order.create.country' | translate }}</label>
        <input
          id="country"
          type="text"
          pInputText
          class="w-full"
          [value]="address().land || ''"
          (input)="updateAddress('land', $any($event.target).value)"
          [placeholder]="'setup.countryPlaceholder' | translate"
        />
      </div>

      <!-- Koordinaten (optional) -->
      <div class="field col-12">
        <div class="grid">
          <div class="col-12 md:col-6">
            <label for="latitude">
              {{ 'order.create.latitude' | translate }}
              @if (isGeocodingLoading()) {
                <i class="pi pi-spin pi-spinner ml-2" style="font-size: 0.8rem"></i>
              }
            </label>
            <input
              id="latitude"
              type="number"
              pInputText
              class="w-full"
              [value]="address().lat || ''"
              (input)="
                updateAddress(
                  'lat',
                  $any($event.target).value ? +$any($event.target).value : undefined
                )
              "
              [placeholder]="'setup.latitudePlaceholder' | translate"
              step="any"
            />
          </div>

          <div class="col-12 md:col-6">
            <label for="longitude">{{ 'order.create.longitude' | translate }}</label>
            <input
              id="longitude"
              type="number"
              pInputText
              class="w-full"
              [value]="address().long || ''"
              (input)="
                updateAddress(
                  'long',
                  $any($event.target).value ? +$any($event.target).value : undefined
                )
              "
              [placeholder]="'setup.longitudePlaceholder' | translate"
              step="any"
            />
          </div>

          <!-- Geocoding Controls -->
          <div class="col-12">
            <div class="flex gap-2 align-items-center mt-2">
              <p-button
                [label]="'setup.determineCoordinates' | translate"
                icon="pi pi-map-marker"
                size="small"
                severity="secondary"
                [outlined]="true"
                (click)="geocodeAddress()"
                [loading]="isGeocodingLoading()"
                [disabled]="!hasAddressData()"
              />
              @if (hasCoordinates()) {
                <p-button
                  [label]="'setup.deleteCoordinates' | translate"
                  icon="pi pi-times"
                  size="small"
                  severity="danger"
                  [outlined]="true"
                  (click)="clearCoordinates()"
                />
              }
              @if (isGeocodingLoading()) {
                <small class="text-color-secondary">
                  {{ 'setup.coordinatesAutomatic' | translate }}
                </small>
              }
            </div>
          </div>
        </div>
      </div>

      <!-- Buttons -->
      <div class="field col-12 flex gap-2 justify-content-end">
        <p-button
          [label]="'setup.reset' | translate"
          severity="secondary"
          (click)="resetAddress()"
          [outlined]="true"
        />
        <p-button [label]="'common.save' | translate" (click)="saveAddress()" icon="pi pi-check" />
      </div>

      <!-- Map Section -->
      @if (hasAddressData() || hasCoordinates()) {
        <div class="field col-12">
          <div class="flex justify-content-between align-items-center mb-3">
            <h6 class="m-0">{{ 'setup.mapView' | translate }}</h6>
            <div class="flex align-items-center gap-2">
              <p-toggleButton
                [ngModel]="mapClickMode()"
                (ngModelChange)="mapClickMode.set($event)"
                [onLabel]="'setup.clickModeOn' | translate"
                [offLabel]="'setup.clickModeOff' | translate"
                [onIcon]="'pi pi-map-marker'"
                [offIcon]="'pi pi-map'"
                [style]="{ 'min-width': '160px' }"
                severity="secondary"
              />
              @if (mapClickMode()) {
                <small class="text-color-secondary">
                  {{ 'setup.clickOnMap' | translate }}
                </small>
              }
            </div>
          </div>
          <div class="map-container">
            <app-leaflet-map
              [location]="getMapLocation()"
              [address]="hasCoordinates() ? undefined : getFormattedAddress()"
              height="400px"
              [zoom]="15"
              [enableClickToSet]="mapClickMode()"
              (locationClicked)="onMapLocationClicked($event)"
            />
          </div>
        </div>
      }
    </div>

    <p-toast />
  </p-accordion-content>
</p-accordion-panel>
