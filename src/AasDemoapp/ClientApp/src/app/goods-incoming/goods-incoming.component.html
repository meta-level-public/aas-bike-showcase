<div class="goods-incoming-container">
  <!-- Header Section -->
  <div class="goods-incoming-header">
    <h1 class="goods-incoming-title">
      <i class="pi pi-truck"></i>
      {{ 'goods.incoming.goodsIncoming' | translate }}
    </h1>
    <p class="goods-incoming-subtitle">{{ 'goods.incoming.subtitle' | translate }}</p>
  </div>

  <!-- Main Content -->
  <div class="goods-incoming-content">
    <!-- Left Panel - Delivery Simulation -->
    <div class="delivery-panel">
      <div class="panel-header">
        <i class="pi pi-play-circle"></i>
        <h3>{{ 'goods.incoming.simulateDelivery' | translate }}</h3>
      </div>

      <div class="delivery-controls mb-3">
        @if (!showTruck) {
          <p-button
            [label]="'goods.incoming.startDelivery' | translate"
            icon="pi pi-truck"
            class="w-full delivery-button"
            (onClick)="startDelivery()"
            [disabled]="showTruck"
            [loading]="loading"
            severity="success"
          >
          </p-button>
        }
        @if (showTruck) {
          <p-button
            [label]="'goods.incoming.resetDelivery' | translate"
            icon="pi pi-refresh"
            class="w-full reset-button"
            severity="secondary"
            (onClick)="resetDelivery()"
          ></p-button>
        }
      </div>

      @if (showTruck) {
        <div class="delivery-animation">
          <!-- Hintergrund Wolken -->
          <div class="cloud cloud1"></div>
          <div class="cloud cloud2"></div>
          <!-- Fabrikgebäude -->
          <div class="factory-building factory-building-1"></div>
          <div class="factory-building factory-building-2"></div>
          <div class="factory-chimney"></div>
          <!-- LKW -->
          <div class="truck" [ngClass]="truckPosition">
            <div class="truck-cab"></div>
            <div class="truck-body">
              <!-- Kiste auf der Ladefläche -->
              @if (showBox) {
                <div
                  class="delivery-box"
                  [ngClass]="{ clickable: isBoxClickable }"
                  (click)="onBoxClick()"
                >
                  <div class="box-text"></div>
                </div>
              }
            </div>
            <div class="truck-wheel wheel-front"></div>
            <div class="truck-wheel wheel-back"></div>
          </div>
        </div>
      }
      @if (showTruck && isBoxClickable) {
        <div class="delivery-status mt-3">
          <p-message
            severity="info"
            [text]="'goods.incoming.clickBoxMessage' | translate"
            [closable]="false"
          ></p-message>
        </div>
      }
    </div>

    <!-- Right Panel - Part Booking -->
    <div class="booking-panel">
      <div class="panel-header">
        <i class="pi pi-barcode"></i>
        <h3>{{ 'goods.incoming.bookPart' | translate }}</h3>
      </div>

      <!-- Input Form -->
      <div class="booking-form">
        <div class="form-group">
          <label for="globalAssetId" class="form-label">
            <i class="pi pi-qrcode"></i>
            {{ 'goods.incoming.globalAssetIdLabel' | translate }}
          </label>
          <p-inputgroup>
            <p-inputgroup-addon>
              <i class="pi pi-search"></i>
            </p-inputgroup-addon>
            <input
              id="globalAssetId"
              type="text"
              [placeholder]="'goods.incoming.scanOrEnter' | translate"
              pInputText
              class="w-full"
              [(ngModel)]="newKatalogEintrag.globalAssetId"
            />
          </p-inputgroup>

          <span class="p-input-icon-right w-full"> </span>
        </div>

        <div class="form-group">
          <p-button
            [label]="'goods.incoming.lookup' | translate"
            icon="pi pi-search"
            (click)="lookup()"
            [loading]="loading"
            class="w-full"
            severity="info"
            [disabled]="!newKatalogEintrag.globalAssetId"
          ></p-button>
        </div>

        <div class="form-group">
          <label for="amount" class="form-label">
            <i class="pi pi-hashtag"></i>
            {{ 'goods.incoming.quantity' | translate }}
          </label>
          <p-inputNumber
            id="amount"
            [(ngModel)]="newKatalogEintrag.amount"
            [showButtons]="true"
            [min]="1"
            [placeholder]="'goods.incoming.enterQuantity' | translate"
            class="w-full"
            buttonLayout="horizontal"
            inputStyleClass="w-full text-center"
            incrementButtonClass="p-button-secondary"
            decrementButtonClass="p-button-secondary"
          ></p-inputNumber>
        </div>

        <div class="form-group">
          <p-button
            [label]="'goods.incoming.bookPart' | translate"
            icon="pi pi-check"
            (click)="createRohteilInstanz()"
            [loading]="loading"
            [disabled]="!parentRohteil || !newKatalogEintrag.amount"
            class="w-full create-btn"
            severity="success"
          ></p-button>
        </div>
      </div>

      <!-- Preview Section -->
      @if (loaded) {
        <div class="preview-section">
          <div class="preview-card">
            <h4 class="preview-title">
              <i class="pi pi-box"></i>
              {{ 'goods.incoming.partInCatalog' | translate }}
            </h4>
            <app-catalog-item [item]="parentRohteil" [showDelete]="false"></app-catalog-item>
          </div>

          <div class="preview-card">
            <h4 class="preview-title">
              <i class="pi pi-external-link"></i>
              {{ 'goods.incoming.instanceAtManufacturer' | translate }}
            </h4>
            <app-catalog-item
              [item]="newKatalogEintrag"
              [imgUrl]="importImageUrl"
              [showDelete]="false"
              [showPrice]="false"
              [showTag]="false"
            ></app-catalog-item>
          </div>
        </div>
      }
      @if (!loaded && (parentRohteil || loading)) {
        <div class="loading-section">
          @if (loading) {
            <div class="loading-state">
              <i class="pi pi-spin pi-spinner"></i>
              <p>{{ 'goods.incoming.loadingPartData' | translate }}</p>
            </div>
          } @else {
            <div class="empty-state">
              <i class="pi pi-info-circle"></i>
              <p>{{ 'goods.incoming.enterGlobalAssetId' | translate }}</p>
            </div>
          }
        </div>
      }
    </div>
  </div>
</div>
