<div class="assembly-container">
  <!-- Header Section -->
  <div class="assembly-header">
    <h1 class="assembly-title">
      <i class="pi pi-wrench"></i>
      Montage
    </h1>
    <p class="assembly-subtitle">Geführte Montage für Produktionsaufträge</p>
  </div>

  <!-- Main Content -->
  <div class="assembly-content">
    <!-- Left Panel - Production Order Selection and Progress -->
    <app-order-selection-panel
      [productionOrders]="productionOrders()"
      [selectedOrder]="selectedProductionOrder()"
      [isRouteBasedSelection]="isRouteBasedSelection()"
      [currentStep]="currentAssemblyStep()"
      [totalSteps]="bestandteileLength()"
      [hasBestandteile]="hasBestandteile()"
      (orderSelected)="onOrderSelected($event)"
    ></app-order-selection-panel>

    <!-- Right Panel - Assembly Steps -->
    <app-assembly-steps-panel
      [selectedOrder]="selectedProductionOrder()"
      [selectedItem]="selectedItem()"
      [currentStep]="currentAssemblyStep()"
      [totalSteps]="bestandteileLength()"
      [hasBestandteile]="hasBestandteile()"
      [assemblyComplete]="assemblyComplete()"
      [toolResultOk]="toolResultOk()"
      [parts]="currentParts()"
      [teilStatusMap]="teilStatusMap()"
      [isToolRequiredForCurrentStep]="isToolRequiredValue()"
      [toolCheckLoading]="toolCheckLoading()"
      [saveLoading]="loading()"
      (nextStep)="onNextStep()"
      (openTool)="onOpenTool()"
      (completeAssembly)="onCompleteAssembly()"
      (partScanned)="onPartScanned($event)"
    ></app-assembly-steps-panel>
  </div>
</div>

<!-- Tool Dialog -->
<app-tool-dialog
  [visible]="showToolDialog()"
  [toolResultOk]="toolResultOk()"
  [requiredToolAasId]="requiredToolAasId() | async"
  [requiredTightenForce]="requiredTightenForceValue()"
  [allowedTightenForceRange]="allowedTightenForceElement() | async"
  [configuredRequiredTightenForce]="configuredRequiredTightenForce()"
  [currentTightenForce]="currentTightenForce()"
  [toolInitialized]="toolInitialized()"
  [checkingToolData]="toolCheckLoading()"
  (initializeTool)="initializeTool()"
  (checkToolData)="checkToolData()"
  (closeDialog)="closeToolDialog($event)"
></app-tool-dialog>

<!-- PDF Viewer Dialog -->
<p-dialog
  [visible]="showPdfDialog()"
  (visibleChange)="showPdfDialog.set($event)"
  [header]="'Übergabedokumentation'"
  [modal]="true"
  [style]="{ width: '90vw', height: '90vh' }"
  [closable]="true"
  [dismissableMask]="true"
  (onHide)="closePdfDialog()"
>
  <div class="pdf-dialog-content">
    @if (pdfBlobUrl()) {
      <iframe
        id="pdf-viewer-iframe"
        [src]="pdfBlobUrl()"
        style="width: 100%; height: 75vh; border: none"
        title="PDF Viewer"
      ></iframe>
    }
  </div>
  <ng-template pTemplate="footer">
    <div class="pdf-dialog-footer">
      <p-button
        label="Herunterladen"
        icon="pi pi-download"
        severity="secondary"
        (onClick)="downloadPdf()"
      ></p-button>
      <p-button
        label="Drucken"
        icon="pi pi-print"
        severity="secondary"
        (onClick)="printPdf()"
      ></p-button>
      <p-button label="Schließen" icon="pi pi-times" (onClick)="closePdfDialog()"></p-button>
    </div>
  </ng-template>
</p-dialog>
