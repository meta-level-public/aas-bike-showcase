@if (item) {
  <div class="col-12">
    <div
      class="flex flex-column xl:flex-row xl:align-items-start p-4 gap-4"
      [ngClass]="{ 'border-top-1 surface-border': !first }"
    >
      <div
        class="flex flex-column sm:flex-row justify-content-between align-items-center xl:align-items-start flex-1 gap-4"
      >
        <div class="flex flex-column align-items-center sm:align-items-start gap-3">
          <div class="text-2xl font-bold text-900">{{ item.name }}</div>
          <div class="flex align-items-center gap-3">
            <span class="flex align-items-center gap-2">
              <i class="pi pi-cog"></i>
              <span class="font-semibold">Konfiguriertes Produkt</span>
            </span>
            @if (getTotalBestandteile() > 0) {
              <span class="flex align-items-center gap-2">
                <i class="pi pi-list"></i>
                <span class="font-semibold">{{ getTotalBestandteile() }} Bestandteile</span>
              </span>
            }
          </div>
        </div>
        <div class="flex sm:flex-column align-items-center sm:align-items-end gap-3 sm:gap-2">
          <span class="text-2xl font-semibold">{{ '$' + item.price }}</span>
          <div class="flex flex-row gap-1">
            @if (getTotalBestandteile() > 0) {
              <button
                pButton
                icon="pi pi-list"
                class="md:align-self-end mb-2 p-button-rounded p-button-outlined"
                (click)="bestandteilePopover.toggle($event)"
                pTooltip="Bestandteile anzeigen"
                tooltipPosition="top"
              ></button>
            }
            <button
              pButton
              icon="pi pi-shopping-cart"
              class="md:align-self-end mb-2 p-button-rounded"
              (click)="openOrderDialog()"
              [loading]="loading"
              pTooltip="Bestellung erstellen"
              tooltipPosition="top"
            ></button>
            <button
              pButton
              icon="pi pi-trash"
              class="md:align-self-end mb-2 p-button-rounded p-button-danger"
              (click)="deleteItem()"
              [loading]="loading"
            ></button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bestandteile Popover -->
  <p-popover #bestandteilePopover [style]="{ width: '450px' }">
    <div class="flex flex-column gap-3 p-0">
      <div class="flex flex-row align-items-center gap-2 bestandteile-header p-3 border-round-top">
        <i class="pi pi-list text-primary text-lg"></i>
        <span class="text-lg font-bold">Bestandteile von {{ item.name }}</span>
      </div>

      @if (item.bestandteile && item.bestandteile.length > 0) {
        <div class="flex flex-column gap-1 px-3">
          @for (bestandteil of item.bestandteile; track bestandteil.id) {
            <div
              class="bestandteile-item flex flex-row justify-content-between align-items-center p-3 border-round"
            >
              <div class="flex flex-column gap-1">
                <span class="font-semibold text-900">{{ bestandteil.name }}</span>
                <div class="flex align-items-center gap-3 text-sm">
                  <span class="text-600">
                    <i class="pi pi-hashtag"></i> {{ bestandteil.amount }}x
                  </span>
                  <span class="text-600">
                    <i class="pi pi-dollar"></i> {{ bestandteil.price }} p. Stück
                  </span>
                </div>
              </div>
              <div class="flex flex-column align-items-end gap-1">
                <span class="font-bold text-primary text-lg"
                  >${{ (bestandteil.price * bestandteil.amount).toFixed(2) }}</span
                >
                <small class="text-600">Gesamt</small>
              </div>
            </div>
          }
        </div>

        <div
          class="bestandteile-summary flex flex-row justify-content-between align-items-center p-3 mx-3 border-round"
        >
          <div class="flex align-items-center gap-2">
            <i class="pi pi-calculator text-primary"></i>
            <span class="font-bold text-900">Gesamtkosten Bestandteile:</span>
          </div>
          <span class="font-bold text-primary text-xl">${{ getTotalPrice().toFixed(2) }}</span>
        </div>

        <div class="px-3 pb-3">
          <small class="text-600">
            <i class="pi pi-info-circle mr-1"></i>
            {{ getTotalBestandteile() }}
            {{ getTotalBestandteile() === 1 ? 'Bestandteil' : 'Bestandteile' }}
            insgesamt
          </small>
        </div>
      } @else {
        <div class="text-center text-600 p-4">
          <i class="pi pi-info-circle text-4xl mb-3 text-300"></i>
          <p class="text-lg font-semibold mb-2">Keine Bestandteile verfügbar</p>
          <p class="text-sm">Dieses Produkt hat noch keine konfigurierten Bestandteile.</p>
        </div>
      }
    </div>
  </p-popover>
}
